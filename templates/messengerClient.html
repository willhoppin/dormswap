<html>

  <head>
    <link rel="shortcut icon" href="{{ url_for('static', filename='favicon.ico') }}">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300,500,700&display=swap" rel="stylesheet" />
  </head>
  <style>
      body{
          margin: 0;
          font-family: Poppins;
      }
      
      .main-wrapper {
          margin-top: 30px;
          background: url({{ url_for('static', filename='backgroundarrows.png') }});
          height: 100vh;
          width: 100%;
          display: flex;
          align-items: center;
          justify-content: center;
      }

      .feature-box {
          background: white;
          border-radius: 15px;
          height: 550px;
          width: 600px;
          box-shadow: 0px 0px 20px 0px #9BCBEB;
          display: flex;
      }

      .left-wrapper {
          width: 299px;
          height: 550px;
          border-right: 2px solid #003865;
      }

      .right-wrapper {
          width: 299px;
          height: 550px;
      }

      .header-text {
          color: #003865;
          font-weight: 500;
          font-size: 20px;
          margin: 20px;
      }

      .chat-preview-wrapper {
          display: flex;
          align-items: center;
      }

      .chat-preview-photo {
        max-height: 30px;
        max-width: 30px;
        object-fit: cover;
        border-radius: 20px;
      }

      .chat-preview-text {
          font-size: 15px;
          color:#003865;
          font-weight: 500;
          font-family: Poppins;
          margin-left: 12px;
      }

      .chat-preview-form {
          margin: 0;
      }

      .chat-preview-button {
          cursor: pointer;
          border: none;
          background: none;
          padding: 12px 20px;
          border-radius: 10px;
          background: white;
          transition: 0.2s ease-in-out;
          width: 279px;
          margin: 0 10px;
      }

      .chat-preview-button:hover {
          background: #dee7ee;
      }

      .chat-preview-selected {
          background: #003865 !important;
      }

      .chat-preview-text-selected {
          color: white !important;
      }

      .chat-preview-photo-selected {
          box-shadow: 0px 0px 10px 0px #ffffff;
      }

      .my-message-wrapper {
          background: #003865;
          margin: 0 10px 10px auto;
          border-radius: 10px 10px 0 10px;
          padding: 10px 12px;
          width:fit-content;
          max-width: 185px;
          color: white;
      }

      .ext-message-wrapper {
          background: #EDF1F4;
          margin: 0 auto 10px 10px;
          max-width: 185px;
          padding: 10px;
          border-radius: 10px 10px 10px 0;
          width:fit-content;
          color: #003865;
      }

      .messages-wrapper {
          height: 350px;
          overflow: auto;
          border-top: 1px solid #003865;
          border-bottom: 1px solid #003865;
          display: flex;
          flex-direction: column;
          font-size: 14px;
          padding-top: 10px;
      }

      .send-message-form {
          display: flex;
          flex-direction: column;
      }

      .message-field-input {
          background: rgb(236, 236, 236);
          border-radius: 10px;
          margin: 10px 10px 0 10px;
          border: none;
          font-family: Poppins;
          height: 60px;
          padding: 5px 10px;
      }

      textarea {
        resize: none;
      }

      .message-submit-btn {
          background: #003865;
          border-radius: 10px;
          color: white;
          height: 30px;
          font-family: Poppins;
          font-weight: 500;
          border: none;
          margin: 10px;
          cursor: pointer;
          transition: 0.2s ease-in-out;
      }

      .message-submit-btn:hover {
          opacity: 0.8;
      }

    
    .logo-form {
      margin: 0;
    }

    .top-wrapper {
        box-shadow: 0px 0px 15px 0px #9BCBEB;
        background: white;
        position: fixed !important;
        top: 0 !important;
        width: 100%;
        justify-content: space-between;
        display: flex;
        align-items: center;
        z-index: 1;
    }

    .top-wrapper-left {
        display: flex;
        align-items: center;
    }

    .logo-button {
      border: none;
      background: white;
      font-family: Poppins;
      cursor: pointer;
    }

    .logo-text-wrapper {
      display: flex;
      align-items: center;
      padding: 10px;
    }

    .logo-image {
      width: 35px;
      border-radius: 23px;
      box-shadow: 0px 0px 15px 0px #c3e4fa;
      margin-right: 10px;
    }

    .logo-text {
      color:#003865;
      font-size:25px;
      font-weight: 700;
      margin-right: 20px;
    }

    .top-wrapper-right {
      display: flex;
      align-items: center;
    }

    .profile-menu-wrapper {
      display: flex;
      align-items: center;
      padding: 8px;
      border-radius: 7px;
      transition: 0.2s ease-in-out;
      margin-right: 10px;
    }

    .profile-menu-photo {
      max-height: 35px;
      max-width: 35px;
      object-fit: cover;
      border-radius: 20px;
    }

    .profile-menu-text {
      font-weight: 500;
      font-size: 15px;
      color: #003865;
      margin: 0 10px 0 15px;
    }

    .top-bar-form {
      margin: 0;
      display: flex;
      align-items: center;
    }

    .filter-button {
      display: flex;
      align-items: center;
      margin-right: 5px;
      border-radius: 30px;
      transition: 0.2s ease-in-out;
      padding: 3px 7px;
      border: none;
      background: white;
    }

    .filter-button:hover {
      background: #d3dce2;
      cursor: pointer;
    }

    .filter-button-icon {
      max-height: 12px;
      max-width: 12px;
      margin-right: 5px;
      object-fit: cover;
    }

    .filter-button-text {
      white-space: nowrap;
      font-family: Poppins;
      color: #003865;
    }

    .top-right-wrapper {
        display: flex;
        align-items: center;
        justify-content: space-between;
    }

    .venmo-link-wrap {
        text-decoration: none;
    }

    .venmo-image {
        width: 40px;
        margin-right: 12px;
        padding: 10px 15px;
        border: 2px solid #008CFF;
        border-radius: 30px;
    }

  </style>

<body>
    <div class="top-wrapper">
        <div class="top-wrapper-left">
          <form class="logo-form" action="/loggedIn/{{current_user.user_id}}">
            <button class="logo-button">
              <div class="logo-text-wrapper">
                <img class="logo-image" src="{{url_for('static', filename='lion.png')}}" align="middle" />
                <div class="logo-text">
                  DormSwap
                </div>
              </div>
            </button>
          </form>
        </div>
        <div class="top-wrapper-right">
          <div class="profile-menu-wrapper">
            <img class="profile-menu-photo" src="{{current_user.photo}}" align="middle" />
            <div class="profile-menu-text">{{current_user.user_name}}</div>
          </div>
          <form class="top-bar-form" action="/logIn">
            <button class="filter-button">
              <img class="filter-button-icon" src="{{url_for('static', filename='logout.png')}}" align="middle" />
              <div class="filter-button-text">Logout</div>
            </button>
          </form>
        </div>
    </div>
    <div class="main-wrapper">
        <div class="feature-box">
            <div class="left-wrapper">
                <div class="header-text">
                    Your Conversations
                </div>
                {% for chat_data in all_chats %}
                    {% if other_user.user_id == chat_data[1].user_id %}
                        <form class="chat-preview-form" action="/messengerClient/{{current_user.user_id}}/{{chat_data[0].chat_id}}">
                            <button class="chat-preview-button chat-preview-selected">
                                <div class="chat-preview-wrapper">
                                    <img class="chat-preview-photo chat-preview-photo-selected" src="{{chat_data[1].photo}}" align="middle" />
                                    <div class="chat-preview-text chat-preview-text-selected">{{chat_data[1].user_name}}</div>
                                </div>
                            </button>
                        </form>
                    {% else %}
                        <form class="chat-preview-form" action="/messengerClient/{{current_user.user_id}}/{{chat_data[0].chat_id}}">
                            <button class="chat-preview-button">
                                <div class="chat-preview-wrapper">
                                    <img class="chat-preview-photo" src="{{chat_data[1].photo}}" align="middle" />
                                    <div class="chat-preview-text">{{chat_data[1].user_name}}</div>
                                </div>
                            </button>
                        </form>
                    {% endif %}
                {% endfor %}
            </div>
            <div class="right-wrapper">
                <div class="top-right-wrapper">
                    <div class="header-text">
                        {% if other_user == [] %}
                        <i>No chat selected</i>
                        {% else %}
                        {{other_user.user_name}}
                        {% endif %}
                    </div>
                    {% if other_user != [] %}
                    <a class="venmo-link-wrap" href="https://account.venmo.com/u/{{other_user.venmo}}" target="blank_">
                        <img class="venmo-image" src="{{url_for('static', filename='venmo.png')}}" align="middle" />
                    </a>
                    {% endif %}
                </div>
                <div class="messages-wrapper" id="scroll-to-bottom">
                    {% for message in messages %}
                        {% if message.sender == current_user.user_id %}
                        <div class="my-message-wrapper">
                            {{message.text}}
                        </div>
                        {% else %}
                        <div class="ext-message-wrapper">
                            {{message.text}}
                        </div>
                        {% endif %}
                    {% endfor %}
                </div>
                <script>
                    let scroll_to_bottom = document.getElementById('scroll-to-bottom');
                    scroll_to_bottom.scrollTop = scroll_to_bottom.scrollHeight;
                </script>
                <form class="send-message-form" action="/sendMessage/{{current_user.user_id}}/{{chat_id}}" method="POST">
                    <textarea class="message-field-input" placeholder="Write a message here" type="text" name="message"></textarea>
                    <input class="message-submit-btn" type="submit" value="Send">
                </form>
            </div>
        </div>
    </div>

</body>


</html>

